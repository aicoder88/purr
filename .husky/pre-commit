#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit validation..."

# Check if pnpm-lock.yaml is in sync with package.json
if command -v pnpm >/dev/null 2>&1; then
  echo "Checking lockfile sync..."
  pnpm install --frozen-lockfile --dry-run 2>/dev/null || {
    echo "‚ùå ERROR: pnpm-lock.yaml is out of sync with package.json"
    echo "   Run 'pnpm install' to update the lockfile, then commit again."
    exit 1
  }
fi

# Check TypeScript
echo "Checking TypeScript..."
npm run check-types || exit 1

# Check ESLint (warnings allowed, errors fail)
echo "Checking ESLint..."
npm run lint -- --max-warnings=50 || exit 1

# Check Dark Mode Compliance (CRITICAL - must pass)
echo "Checking Dark Mode Compliance..."
npm run validate-dark-mode || exit 1

echo "‚úÖ All checks passed! Proceeding with commit..."